<!DOCTYPE html>

<html dir="ltr" lang="ja">
<head>
<meta charset="utf-8"/>
<title>column:音楽データ</title>
<meta content="DokuWiki" name="generator"/>
<meta content="#008800" name="theme-color"/>
<meta content="index,follow" name="robots"/>
<meta content="column,音楽データ" name="keywords"/>
<link href="/lib/exe/opensearch.php" rel="search" title="FE改造wiki" type="application/opensearchdescription+xml"/>
<link href="/" rel="start"/>
<link href="/doku.php?id=column:%E9%9F%B3%E6%A5%BD%E3%83%87%E3%83%BC%E3%82%BF&amp;do=index" rel="contents" title="サイトマップ"/>
<link href="/lib/exe/manifest.php" rel="manifest"/>
<link href="/feed.php" rel="alternate" title="最近の変更" type="application/rss+xml"/>
<link href="/feed.php?mode=list&amp;ns=column" rel="alternate" title="現在の名前空間" type="application/rss+xml"/>
<link href="/doku.php?do=export_xhtml&amp;id=column:%E9%9F%B3%E6%A5%BD%E3%83%87%E3%83%BC%E3%82%BF" rel="alternate" title="プレーンHTML" type="text/html"/>
<link href="/doku.php?do=export_raw&amp;id=column:%E9%9F%B3%E6%A5%BD%E3%83%87%E3%83%BC%E3%82%BF" rel="alternate" title="Wikiマークアップ" type="text/plain"/>
<link href="https://dw.ngmansion.xyz/doku.php?id=column:%E9%9F%B3%E6%A5%BD%E3%83%87%E3%83%BC%E3%82%BF" rel="canonical"/>
<link href="/lib/exe/css.php?t=dokuwiki&amp;tseed=aa47a2b95c30e9dd18cd50f1c3263767" rel="stylesheet" type="text/css"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='column';var JSINFO = {"isadmin":0,"isauth":0,"move_renameokay":false,"id":"column:\u97f3\u697d\u30c7\u30fc\u30bf","namespace":"column","ACT":"export_xhtml","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f" type="text/javascript"></script>
<script charset="utf-8" src="/lib/exe/js.php?t=dokuwiki&amp;tseed=aa47a2b95c30e9dd18cd50f1c3263767" type="text/javascript"></script>
<!--<![endif]-->
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div class="dw__toc" id="dw__toc">
<h3 class="toggle">目次</h3>
<div>
<ul class="toc">
<li class="level1"><div class="li"><a href="#sappy_で聞いた時の構造">sappy で聞いた時の構造</a></div></li>
<li class="level1"><div class="li"><a href="#データ曲の構造">データ曲の構造</a></div></li>
<li class="level1"><div class="li"><a href="#table">table</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#実例">実例</a></div></li>
<li class="level2"><div class="li"><a href="#バイト割当例">バイト割当例</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#header">header</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#実例1">実例</a></div></li>
<li class="level2"><div class="li"><a href="#バイト割当例1">バイト割当例</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#楽譜_track">楽譜(track)</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#バイト割当例2">バイト割当例</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#命令コード表">命令コード表</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#xb1_曲の終端">0xB1 曲の終端</a></div></li>
<li class="level3"><div class="li"><a href="#xb2_ループ">0xB2 ループ</a></div></li>
<li class="level3"><div class="li"><a href="#xbb_楽器の選択">0xBB 楽器の選択</a></div></li>
<li class="level3"><div class="li"><a href="#xbc_曲開始">0xBC 曲開始???</a></div></li>
<li class="level3"><div class="li"><a href="#ウェイト命令">ウェイト命令</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#長さを知るには">長さを知るには？</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#voices_楽器データ">voices(楽器データ)</a></div></li>
<li class="level1"><div class="li"><a href="#参照図">参照図</a></div></li>
<li class="level1"><div class="li"><a href="#ソングテーブルの先頭位置を見つける方法">ソングテーブルの先頭位置を見つける方法</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<p>
FE GBAとかでよく使われる音楽の構造について
</p>
<h1 class="sectionedit1" id="sappy_で聞いた時の構造">sappy で聞いた時の構造</h1>
<div class="level1">
<p>
sappy を使うと、gbaのrom内にある音楽ファイルを直接聞いたり、編集したりできます。<br/>
<br/>
<a class="urlextern" href="http://i.imgur.com/wuiwcdI.jpg" rel="nofollow" title="http://i.imgur.com/wuiwcdI.jpg">http://i.imgur.com/wuiwcdI.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;sappy \u3067\u805e\u3044\u305f\u6642\u306e\u69cb\u9020&quot;,&quot;hid&quot;:&quot;sappy_\u3067\u805e\u3044\u305f\u6642\u306e\u69cb\u9020&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;63-258&quot;} -->
<h1 class="sectionedit2" id="データ曲の構造">データ曲の構造</h1>
<div class="level1">
<div class="table sectionedit3"><table class="inline">
<tr class="row0">
<td class="col0">table</td><td class="col1">曲のヘッダーなどを指定する部分</td>
</tr>
<tr class="row1">
<td class="col0">header</td><td class="col1">曲の楽譜(track)や、楽器(voices)などを設定する部分</td>
</tr>
<tr class="row2">
<td class="col0">track</td><td class="col1">*.sファイルから生成される楽譜</td>
</tr>
<tr class="row3">
<td class="col0">voices</td><td class="col1">演奏に使う楽器データ</td>
</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;297-517&quot;} -->
<p>
<a class="urlextern" href="http://i.imgur.com/oT1Ss0j.jpg" rel="nofollow" title="http://i.imgur.com/oT1Ss0j.jpg">http://i.imgur.com/oT1Ss0j.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30c7\u30fc\u30bf\u66f2\u306e\u69cb\u9020&quot;,&quot;hid&quot;:&quot;\u30c7\u30fc\u30bf\u66f2\u306e\u69cb\u9020&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;259-551&quot;} -->
<h1 class="sectionedit4" id="table1">table</h1>
<div class="level1">
<p>
<a class="urlextern" href="http://i.imgur.com/FIW87CG.jpg" rel="nofollow" title="http://i.imgur.com/FIW87CG.jpg">http://i.imgur.com/FIW87CG.jpg</a>
</p>
<p>
楽曲データの header がどこにあるのかなどの情報がはいっています。<br/>
8byteデータの連続で、所定の場所に固まっています。<br/>
(FE8の場合 0x214120から存在します。 )<br/>
</p>
<pre class="code">//曲テーブル 8byteデータの連続です。所定の場所に固まっています。
struct table{
	void* header; //ヘッダーへのポインタ
 	BYTE  is_filds1;//? フィールドで使う場合is_filds1とis_filds2の両方に1を入れる
	BYTE  zero1;	//不明 常に 0
	BYTE  is_filds2;//? フィールドで使う場合is_filds1とis_filds2の両方に1を入れる 
	BYTE  zero2;	//不明 常に 0
};
//曲の数だけ連続して並ぶ
//ProjectFEGBAでは、ソングテーブルとしてアクセスできる
struct table songtable[...];</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;table&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;552-1401&quot;} -->
<h2 class="sectionedit5" id="実例">実例</h2>
<div class="level2">
<p>
FE8の場合 0x214120から存在します。 <br/>
0番めの曲は利用されないっぽい？ので、0x214120+0x8バイト=0x214128から1番目の曲が始まります。<br/>
<br/>
<a class="urlextern" href="http://i.imgur.com/AivbGPE.jpg" rel="nofollow" title="http://i.imgur.com/AivbGPE.jpg">http://i.imgur.com/AivbGPE.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5b9f\u4f8b&quot;,&quot;hid&quot;:&quot;\u5b9f\u4f8b&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;1402-1632&quot;} -->
<h2 class="sectionedit6" id="バイト割当例">バイト割当例</h2>
<div class="level2">
<p>
<a class="urlextern" href="http://i.imgur.com/vHR4B1D.jpg" rel="nofollow" title="http://i.imgur.com/vHR4B1D.jpg">http://i.imgur.com/vHR4B1D.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b&quot;,&quot;hid&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:6,&quot;range&quot;:&quot;1633-1697&quot;} -->
<h1 class="sectionedit7" id="header">header</h1>
<div class="level1">
<p>
<a class="urlextern" href="http://i.imgur.com/oJzUNaP.jpg" rel="nofollow" title="http://i.imgur.com/oJzUNaP.jpg">http://i.imgur.com/oJzUNaP.jpg</a>
</p>
<p>
曲の楽譜(track)や、楽器(voices)などを設定する部分です。<br/>
曲毎に存在します。<br/>
</p>
<pre class="code">//曲ヘッダー 曲毎に存在します。
struct header{
	BYTE  track_count;	//トラック数
	BYTE  zero;			//常に0
	BYTE  nazo1;			//??
	BYTE  nazo2;			//??
	void* voices; 		//voices(楽器データ)へのポインタ
	
	void* track[track_count];	//楽譜ポインタがトラック数分続く
};</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;header&quot;,&quot;hid&quot;:&quot;header&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:7,&quot;range&quot;:&quot;1698-2181&quot;} -->
<h2 class="sectionedit8" id="実例1">実例</h2>
<div class="level2">
<p>
sappyのheaderを頼りにしてください。<br/>
<a class="urlextern" href="http://i.imgur.com/rrfdITN.jpg" rel="nofollow" title="http://i.imgur.com/rrfdITN.jpg">http://i.imgur.com/rrfdITN.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u5b9f\u4f8b&quot;,&quot;hid&quot;:&quot;\u5b9f\u4f8b1&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:8,&quot;range&quot;:&quot;2182-2283&quot;} -->
<h2 class="sectionedit9" id="バイト割当例1">バイト割当例</h2>
<div class="level2">
<p>
<a class="urlextern" href="http://i.imgur.com/3hASPos.jpg" rel="nofollow" title="http://i.imgur.com/3hASPos.jpg">http://i.imgur.com/3hASPos.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b&quot;,&quot;hid&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b1&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:9,&quot;range&quot;:&quot;2284-2347&quot;} -->
<h1 class="sectionedit10" id="楽譜_track">楽譜(track)</h1>
<div class="level1">
<p>
<a class="urlextern" href="http://i.imgur.com/UDyykAT.jpg" rel="nofollow" title="http://i.imgur.com/UDyykAT.jpg">http://i.imgur.com/UDyykAT.jpg</a><br/>
音楽の楽譜が格納されています。<br/>
.s から生成されるデータです。<br/>
<br/>
データは可変長で、1バイトの命令と可変長の引数(引数がない場合もある)から構成されています。<br/>
</p>
<pre class="code">//楽譜データ
struct track{
	BYTE oprande;	//命令
	variant args;	//引数  可変長
};</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u697d\u8b5c(track)&quot;,&quot;hid&quot;:&quot;\u697d\u8b5c_track&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;2348-2750&quot;} -->
<h2 class="sectionedit11" id="バイト割当例2">バイト割当例</h2>
<div class="level2">
<p>
<a class="urlextern" href="http://i.imgur.com/wlGkXtO.jpg" rel="nofollow" title="http://i.imgur.com/wlGkXtO.jpg">http://i.imgur.com/wlGkXtO.jpg</a>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b&quot;,&quot;hid&quot;:&quot;\u30d0\u30a4\u30c8\u5272\u5f53\u4f8b2&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:11,&quot;range&quot;:&quot;2751-2814&quot;} -->
<h1 class="sectionedit12" id="命令コード表">命令コード表</h1>
<div class="level1">
<p>
命令は 0xBx 0xCx と、 BかCから始まることが多いです。<br/>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u547d\u4ee4\u30b3\u30fc\u30c9\u8868&quot;,&quot;hid&quot;:&quot;\u547d\u4ee4\u30b3\u30fc\u30c9\u8868&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:12,&quot;range&quot;:&quot;2815-2923&quot;} -->
<h3 class="sectionedit13" id="xb1_曲の終端">0xB1 曲の終端</h3>
<div class="level3">
<p>
実例:<br/>
0xB1
</p>
<p>
引数:<br/>
0xB1 なし
</p>
<p>
その他:
</p>
<p>
対応s命令:<br/>
.byte	FINE
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;0xB1 \u66f2\u306e\u7d42\u7aef&quot;,&quot;hid&quot;:&quot;xb1_\u66f2\u306e\u7d42\u7aef&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:13,&quot;range&quot;:&quot;2924-3026&quot;} -->
<h3 class="sectionedit14" id="xb2_ループ">0xB2 ループ</h3>
<div class="level3">
<p>
実例:<br/>
0xB2 0x29 0xF2 0x15 0x09
</p>
<p>
引数:<br/>
0x29 0xF2 0x15 0x09 ループ先のポインタ
</p>
<p>
対応s命令:<br/>
.byte	GOTO<br/>
.word	loop
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;0xB2 \u30eb\u30fc\u30d7&quot;,&quot;hid&quot;:&quot;xb2_\u30eb\u30fc\u30d7&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:14,&quot;range&quot;:&quot;3027-3181&quot;} -->
<h3 class="sectionedit15" id="xbb_楽器の選択">0xBB 楽器の選択</h3>
<div class="level3">
<p>
実例:<br/>
0xBB 0x50
</p>
<p>
引数:<br/>
0x50 楽器コードを指定する。 1-127 まで
</p>
<p>
対応s命令:<br/>
.byte		VOICE , 80
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;0xBB \u697d\u5668\u306e\u9078\u629e&quot;,&quot;hid&quot;:&quot;xbb_\u697d\u5668\u306e\u9078\u629e&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:15,&quot;range&quot;:&quot;3182-3327&quot;} -->
<h3 class="sectionedit16" id="xbc_曲開始">0xBC 曲開始???</h3>
<div class="level3">
<p>
実例:<br/>
0xBC 0x00
</p>
<p>
引数:<br/>
0x00 常に00らしい
</p>
<p>
対応s命令:<br/>
???
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;0xBC \u66f2\u958b\u59cb???&quot;,&quot;hid&quot;:&quot;xbc_\u66f2\u958b\u59cb&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;3328-3427&quot;} -->
<h3 class="sectionedit17" id="ウェイト命令">ウェイト命令</h3>
<div class="level3">
<div class="table sectionedit18"><table class="inline">
<tr class="row0">
<td class="col0">W96</td><td class="col1">0xB0</td>
</tr>
<tr class="row1">
<td class="col0">W32</td><td class="col1">0x9B</td>
</tr>
<tr class="row2">
<td class="col0">W24</td><td class="col1">0x98</td>
</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;3460-3492&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30a6\u30a7\u30a4\u30c8\u547d\u4ee4&quot;,&quot;hid&quot;:&quot;\u30a6\u30a7\u30a4\u30c8\u547d\u4ee4&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:17,&quot;range&quot;:&quot;3428-3494&quot;} -->
<h2 class="sectionedit19" id="長さを知るには">長さを知るには？</h2>
<div class="level2">
<p>
先頭から読んでいって、Bx Cx の命令がでたら、命令コード表に従い解釈していく。<br/>
0xB1 が現れたら、終端です。<br/>
</p>
<pre class="code">//header.trackに楽譜へポインタが書いてある
void* pos = ROM[ header.track[0] ];
while(1)
{
	if (*pos &lt; 0x80)
	{
	  //音符
	  pos++;
	}
	//0x80以上はコントロールコード
	else if (*pos == 0xB1)
	{//曲終端
		pos++;
	}
	else if (*pos == 0xB2)
	{//曲終端
		//ループ 4バイトポインタ
		pos += 4;
	}
	else if (*pos == 0xB3)
	{//nazo
		pos += 4;
	}
	else if (*pos == 0xBB)
	{//nazo
		pos += 2;
	}
	else if (*pos == 0xBC)
	{//楽器
		pos += 2;
	}
	else if (*pos == 0xBD)
	{//ボリューム
		pos += 2;
	}
	else if (*pos == 0xBE)
	{//nazo
		pos += 2;
	}
	else if (*pos == 0xBF)
	{//nazo
		pos += 2;
	}
	else if (*pos == 0xC0)
	{//nazo
		pos += 2;
	}
	else if (*pos == 0xC1)
	{//nazo
		pos += 2;
	}
	else 
	{//未サポート命令
		pos++;
	}

}</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u9577\u3055\u3092\u77e5\u308b\u306b\u306f\uff1f&quot;,&quot;hid&quot;:&quot;\u9577\u3055\u3092\u77e5\u308b\u306b\u306f&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:19,&quot;range&quot;:&quot;3495-4483&quot;} -->
<h1 class="sectionedit20" id="voices_楽器データ">voices(楽器データ)</h1>
<div class="level1">
<p>
<a class="urlextern" href="http://i.imgur.com/aK30dfk.jpg" rel="nofollow" title="http://i.imgur.com/aK30dfk.jpg">http://i.imgur.com/aK30dfk.jpg</a>
</p>
<p>
音を奏でる楽器について定義する部分です。<br/>
<br/>
とても長くなるのでページを分けます。<br/>
<a class="wikilink2" href="../%E8%A7%A3%E8%AA%AC/%E6%A5%BD%E5%99%A8%E3%83%87%E3%83%BC%E3%82%BF.html" rel="nofollow" title="解説:楽器データ">楽器データ</a>を参照ください。<br/>
</p>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;voices(\u697d\u5668\u30c7\u30fc\u30bf)&quot;,&quot;hid&quot;:&quot;voices_\u697d\u5668\u30c7\u30fc\u30bf&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:20,&quot;range&quot;:&quot;4484-4749&quot;} -->
<h1 class="sectionedit21" id="参照図">参照図</h1>
<div class="level1">
<pre class="code">header[] -----&gt; table[] -------&gt; track 楽譜データ
                   |                  |楽器番号で呼び出し
                   |                  /
                   ------------&gt; voices 楽器データ[127]
</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u53c2\u7167\u56f3&quot;,&quot;hid&quot;:&quot;\u53c2\u7167\u56f3&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:21,&quot;range&quot;:&quot;4750-5016&quot;} -->
<h1 class="sectionedit22" id="ソングテーブルの先頭位置を見つける方法">ソングテーブルの先頭位置を見つける方法</h1>
<div class="level1">
<p>
FE8の場合 ソングテーブルは0x214120から存在しますが、<br/>
ゲーム毎に変わるソングテーブルを見つける方法として以下の様な方法があります。<br/>
0x00 0xB5 0x00 0x04 0x07 0x4A 0x08 0x49 0x40 0x0B 0x40 0x18 0x83 0x88 0x59 0x000xC9 0x18 0x89 0x00 0x89 0x18 0x0A 0x680x01 0x68 0x10 0x1C 0x00 0xF0 (11bytes skip) [song table start address]<br/>
<br/>
もちろん、偶然一致してしまうことがあるので、それが本当にソングーブルぽいのか検証しなくてはけいませんが、<br/>
上記のような感じで、ROMを検索すると ソングテーブルの開始位置を取得することが出来ます。<br/>
具体的には、以下のようなコードになります。<br/>
</p>
<pre class="code">def findsonglistoffset(ROM):
	selectsong_code = [
		0x00, 0xB5, 0x00, 0x04, 0x07, 0x4A, 0x08, 0x49,
		0x40, 0x0B, 0x40, 0x18, 0x83, 0x88, 0x59, 0x00,
		0xC9, 0x18, 0x89, 0x00, 0x89, 0x18, 0x0A, 0x68,
		0x01, 0x68, 0x10, 0x1C, 0x00, 0xF0]
 	selectsong_code_len = len(selectsong_code)
	
	matchcount = 0
	position = 0
	position_max = len(ROM)
	while position &lt; position_max:
		byte = ROM[position]
		position += 1
		if (byte != selectsong_code[matchcount] ):
			matchcount = 0
 			continue
		matchcount += 1
		if (matchcount &lt; selectsong_code_len):
			continue

		songlist = 10 + position
		songlist_address = ROM.read_int(songlist)
		
		#this is song table
		if ( not is_pointer(songlist_address) ):
			matchcount = 0
			continue

		#checksong pointer
		songlist_offset = as_offset(songlist_address)
		songfirst_address = ROM.read_int(songlist_offset+8)
		if ( not is_pointer(songfirst_address) ):
			matchcount = 0
			continue

		#maybe songlist
		return songlist_offset

	return None;</pre>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;\u30bd\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u982d\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u65b9\u6cd5&quot;,&quot;hid&quot;:&quot;\u30bd\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u982d\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u65b9\u6cd5&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:22,&quot;range&quot;:&quot;5017-&quot;} --></div>
</body>
</html>
